@page "/Rossum"
@inject MainLayoutService mainLayoutService;
@inject IRossumService rossumService;
@inject RossumExtractorService  rossumExtractor; 
@using MattTools.Data;

<!--Bottom Text-->
@if (rossumExtractor.loginCache.key != string.Empty)
{
    <div class="bottomRightText">
        <p>@rossumExtractor.loginCache.key</p>
    </div>
}

<!--Login-->
<div class="content center animate flyFadeIn">

    <div class="centerContainer" style="display: flex; flex-direction: column; align-items: center">

        <div class="mainHeader" style="margin-top: 148px; justify-content: center">

            <div style="transform:scale(1.75); margin-bottom: 16px">
                <TitleText text="Rossum Extractor" icon="icon/rossumIcon.svg" />
            </div>

        </div>

        <div style="display: flex; flex-direction:column; margin-top: 16px; gap: 16px; width: 320px;">
            <input type="text" placeholder="Username" @bind="loginUsername" tabindex="0"/>
            <input type="password" placeholder="Password" @bind="loginPassword" tabindex="1" />
            <button @onclick="Login" style="width: 100%; height: 45px">Login</button>
        </div>

    </div>
</div>

@code {

    public string loginUsername = "";
    public string loginPassword = "";

    public async void Login()
    {
        if (loginUsername == "" && loginPassword == "")
        {
            mainLayoutService.CreateDialog("Error", "Please fill the form.");
            return;
        }

        mainLayoutService.ShowLoading("Loging In");

        RossumData.LoginRespone response = await rossumService.Login(new RossumData.LoginForm { username = loginUsername, password = loginPassword, key = null });

        mainLayoutService.HideLoading();

        await Task.Delay(250);

        if (response.key != null)
        {
            mainLayoutService.CreateDialog("Login Success", "Welcome " + loginUsername + "! <br> key : " + response.key);
            rossumExtractor.SaveLoginCache(loginUsername, response.key);
            StateHasChanged();
        }
        else if (response.error != null)
        {
            mainLayoutService.CreateDialog("Login Failed", response.error);
        }

    }

}